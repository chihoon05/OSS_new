제목: 오픈소스 소프트웨어 PythonRobotics 조사 및 연구
========================================================
팀원: 생물산업기계공학과/2021428244/안치훈 (chihoon05)
      생물산업기계공학과/2022428013/최하늘 (choihaneul1)
     식품공학부 식품생물공학전공/2023021105/김다현 (Dahyeon-Kim)
     식품공학부 식품생물공학전공/2023009123/손선화 (thstjsghk)
     경상대학 경영학부/2021113385/장윤서 (wkddbstj1)
========================================================
# 1. 개요
PythonRobotics는 로봇 공학에서 사용되는 다양한 알고리즘을 Python으로 구현한 오픈소스 프로젝트입니다.
이 프로젝트는 다양한 로봇 공학의 핵심 알고리즘들이 구현되어 있고, 알고리즘의 작동방식을 시각적으로 확인할 수 있도록 시뮬레이션 예시들이 포함되어 있습니다.
========================================================
# 2. 라이선스
# MIT 라이선스
메사추세츠 공과대학교에서 해당 대학교의 소프트웨어 공학도들을 돕기 위해 개발한 라이선스입니다. MIT 라이선스는 아래와 같이 규정하고 있습니다.

이 소프트웨어와 이와 관련된 모든 문서 (이하 소프트웨어)의 복제본을 보유하게 되는 모든 사용자에 대하여, 다음의 권한들이 무상으로 부여됩니다.
- 상업적 이용
- 배포
- 수정
- 개인적 이용

<주의사항>
- 판매적격성, 특정 용도에 대한 적합성, 비침해 혹은 그이상의 범위를 포함한 사항을 보증하지 않습니다.
- 어떠한 경우에도 저작자 또는 저작권자는 본 소프트웨어의 사용 또는 기타 거래로 인해 발생하는 계약, 불법 행위, 청구 및 손해에 대해 책임지지 않습니다.

# 3. 주요기능
# 1) Localization (위치추정)

# Extended Kalman Filter Localization(확장 칼만 필터 위치추정, EKF Localization)
EKF(Extended Kalman Filter)를 사용한 센서 융합 위치추정입니다.
파란색 선은 실제 궤적, 검은색 선은 추측 궤적, 녹색 점은 위치 관측(예: GPS), 빨간색 선은 EKF로 추정된(추측된) 궤적입니다.
<img width="590" alt="Extended Kalman Filter Localization" src="https://github.com/chihoon05/OSS_new/assets/166033329/e985b377-d99c-4a8d-9544-340415883589">

+) Kalman Filter with Speed Scale Factor Correction
속도 보정이 있는 확장 칼만 필터(EKF) 위치추정입니다.
이는 휠 마모와 같은 요인으로 인한 축적 계수 오류로 측정된 로봇의 속도를 수정하기 위한 것 입니다.
![Kalman Filter with Speed Scale Factor Correction](https://github.com/chihoon05/OSS_new/assets/166033329/49967150-58b9-4d0b-b92e-b70539802ffb)

# Histogram filter localization(히스토그램 필터 위치추정)
Histogram filter를 사용한 2D 위치추정 예시입니다.
빨간색 X 표시는 실제 위치, 검은 점은 RFID 위치, 파란색 격자는 히스토그램 필터의 위치 확률을 나타냅니다.
이 시뮬레이션에서는, 로봇의 yaw 방향과 RFID의 위치는 알려져 있지만 x,y 위치는 알려져 있지 않다고 가정합니다.
Histogram filter는 위치추정을 위해 RFID의 속도 입력 및 범위 관찰을 사용합니다.
![Histogram filter localization](https://github.com/chihoon05/OSS_new/assets/166033329/e383c4d1-a37a-4abd-bc49-34d8b5bdc15c)

히스토그램 필터가 확률 분포를 추정하는 데는 총 Four Steps, 4단계로 구성됩니다. 
[Step1: 필터 초기화]
- 히스토그램 필터는 초기 위치 정보가 필요하지 않습니다.
그 경우, 각 grid probability을 동일한 값으로 초기화할 수 있습니다.
[Step2: 움직임에 의한 확률 예측]
- 히스토그램 필터에서 로봇이 다음 grid(그리드)에서 모든 확률 정보가 이동 방향으로 이동됩니다.
<img width="320" alt="Histogram filter localization  step2" src="https://github.com/chihoon05/OSS_new/assets/166033329/92e6c2d6-14cf-49e1-a238-ed8623d5df61">

이 과정은 로봇 이동으로, 확률 분포를 나타냅니다.
[Step3: 관측에 의한 확률 업데이트]
- 이것은 bayesian filter의 업데이트 단계입니다.
확률 업데이트 공식은 사용 센서 모델에 의해 달라집니다.
<img width="320" alt="Histogram filter localization  step3" src="https://github.com/chihoon05/OSS_new/assets/166033329/c3dc73f6-9d63-455c-927c-a20533cad980">

[Step4: 확률로부터 위치 추정]
- 각 단계에서, 현재 확률 분포에서 최종 로봇 위치를 계산할 수 있습니다. 최종 위치를 계산하려면 두 가지 방법이 있습니다.
(1) 최대 확률 그리드 위치를 사용합니다.
(2) 확률 가중치 위치를 사용하여 위치를 사용합니다.

# 2) Mapping (도표화)

# Gaussian grid map (가우시안 격자 맵)
랜드마크 위치를 나눠진 연속공간에서 가우시안으로 나타냅니다.
4개의 랜드마크와 해상도를 사용해 격자 지도의 크기를 설정해주고 첫번째 셀에 가장 가까운 랜드마크의 거리를 구합니다.
이 함수는 랜드마크와 가장 가까운 셀일수록 높은 확률값을 가지게 됩니다.
![animation](https://github.com/chihoon05/OSS_new/assets/166050709/755130a8-57b8-49e1-b591-4c1fe9c61c28)

# Normal Distance Transform (NDT) map (정규 분포 변환 맵)
정규 분포 변환(NDT)은 관측점 모델링을 위해 정규 분포를 사용하여 지도를 표현합니다.
- 새로운 관찰이 생깁니다.

   ![raw_observations](https://github.com/chihoon05/OSS_new/assets/166050709/de0c0f87-6845-42d1-98ab-3873a3cd4087)
- 그리드 기반 클러스터링 알고리즘을 사용하여 관측점을 군집화합니다.
  ![grid_clustering](https://github.com/chihoon05/OSS_new/assets/166050709/bc4a9300-97e3-4a3c-bf8a-0c4695425f65)
- 각 그리드 클러스터에 정규 분포를 적합시킵니다.
  ![ndt_map1](https://github.com/chihoon05/OSS_new/assets/166050709/d8379009-2a6e-48b5-8c49-38bea2eda8a6)
- 검은색 타원은 각 NDT 그리드를 다음과 같이 표시합니다.
  ![ndt_map2](https://github.com/chihoon05/OSS_new/assets/166050709/2a20392f-c7da-4edf-94be-656fce140c00)

# Point cloud Sampling (포인트 클라우드 샘플링)
포인트 클라우드는 2차원 및 3차원 기반 데이터로 LIDAR, 카메라 등과 같은 외부 센서에 의해 획득됩니다.
일반적으로 포인트 클라우드 데이터는 데이터 수가 매우 많아 모든 데이터를 처리하면 시간이 오래 걸립니다.
포인트 클라우드 샘플링은 대표 점 데이터만 추출하고 포인트 클라우드 데이터를 이용한 처리 성능을 손상시키지 않고 포인트 클라우드 데이터를 얇게 하여 복잡한 계산 문제를 해결합니다.

1. Voxel Point Sampling (복셀 격자 샘플링) : 복셀 격자 샘플링은 3차원 공간에서 정규 격자인 복셀 격자를 이용해 포인트 클라우드 데이터를 줄이는 방법입니다.
이 방법은 격자에 각 포인트가 있는지 확인하고 동일한 복셀에 있는 포인트 클라우드를 평균으로 대체하여 점의 수를 줄입니다.
<img width="415" alt="voxel_point_sampling" src="https://github.com/chihoon05/OSS_new/assets/166050709/0e37effa-6dc0-410b-9f5a-207e2946fe82">

2. Farthest Point Sampling (최원점 샘플링) : 최원점 샘플링은 점 사이의 거리가 최대한 멀어지도록 지정된 개수의 점에 의한 포인트 클라우드 샘플링 방법입니다.
이 방법은 포인트 클라우드에서 지정된 개수의 포인트를 얻고자 하는 기계 학습 및 기타 상황에 유용합니다.
<img width="400" alt="farthest_point_sampling" src="https://github.com/chihoon05/OSS_new/assets/166050709/9f135293-dc3f-402e-b082-20683004bf98">

3. Poisson Disk Sampling (포아송 디스크 샘플링) : 포아송 디스크 샘플은 지정된 점 수만큼 포인트 클라우드를 샘플링하는 방식으로, 알고리즘이 선택한 점으로부터 거리가 일정 거리보다 큰 점을 선택합니다.
이 방법은 각 점이 서로 멀리 분포되어 있는 가장 먼 거리의 샘플을 비교할 때는 성능이 좋지 않지만 계산 시간이 빠르기 때문에 실시간 처리에 적합합니다.
<img width="506" alt="poisson_disk_sampling" src="https://github.com/chihoon05/OSS_new/assets/166050709/30cbe154-7afa-481f-83a3-c73eac3fc429">

# Object shape recognition using circle fitting (원 피팅을 이용한 물체 형상 인식)
원 피팅을 이용한 물체 형상 인식 그래프입니다.
파란색 원은 실체 개체 모양이고 빨간색 십자가는 거리 측정 센서의 관측치입니다.
빨간색 원은 원 피팅을 사용하여 추정된 물체의 모양입니다.

![animation](https://github.com/chihoon05/OSS_new/assets/166050709/92bfe182-519c-453b-89ae-6e7ca6492e83)

# Object shape recognition using rectangle fitting (직사각형 피팅을 이용한 물체 형상 인식)
![animation](https://github.com/chihoon05/OSS_new/assets/166050709/d83b2b62-77c6-4359-8734-689243532639)

1단계 : 적응형 범위 분할
각 범위 데이터와 가장 가까운 범위 데이터 사이의 거리를 계산하고, 이 거리가 센서로부터의 거리에 비례한 특정 임계값 미만이면 동일한 클러스터에 있는 것으로 판단합니다.

2단계 : 직사각형 검색
1단계에서 계산된 각 클러스터의 거리 데이터가 특정 각도 간격으로 회전합니다. 아래의 세 가지 평가 함수 중 하나로 평가한 후 가장 좋은 각도 매개변수 하나가 직사각형 모양으로 선택됩니다.

1. 직사각형 영역 최소화 기준
모든 거리 데이터 요소에 대한 x-y축의 최대값과 최소값 간의 차이에서 파생된 모든 점을 포함하는 가장 작은 직사각형의 면적을 계산합니다.
이를 통해 최대한 작은 직사각형 모양을 포함하는 방향으로 직사각형을 맞출 수 있습니다.

2. 친밀도 기준
사각형의 오른쪽 위의 꼭짓점과 오른쪽 아래의 꼭짓점 사이의 거리와 거리 데이터의 각 점을 평가 값으로 사용합니다.
직사각형 가장자리에 점이 있는 경우 이 평가 값은 감소합니다.

3. 분산 기준
직사각형의 가장자리와 각 점 사이의 제곱 거리를 사용해 제곱 오차, 즉 분산을 계산합니다.
분산이 작을수록 점이 직사각형 내에 더 많이 들어있다는 것을 나타냅니다.

# 3) SLAM (동시 위치추정 및 도표화, Simultaneous Localization And Mapping)

# Iterative Closest Point (ICP) Matching (반복적 최단거리 지점 찾기)
특이값 분해가 있는 2D ICP 매칭 예시이고, 회전 행렬, 점과 점 사이의 변환벡터를 계산할 수 있습니다.
정확한 대응관계를 알고 있다면, 상대회전 또는 변환을 닫힌 형태로 정확히 계산할 수 있습니다.
ICP는 스캔한 것들 사이의 변위를 계산하는 강력한 알고리즘입니다. 주요 문제는 올바른 데이터의 연관성을 결정하는 것입니다. 
올바른 데이터 연관성이 주어지면 특이값 분해를 사용하여 변환을 효율적으로 계산할 수 있습니다.
![Iterative Closest Point (ICP) Matching](https://github.com/chihoon05/OSS_new/assets/165778887/88872fe4-52ed-4560-8c83-28292451cdd5)


# Fast SLAM 1.0
파란선은 실측 자료이고, 검은선은 신호가 없는 동안 추측한 것, 빨간선은 FastSLAM을 이용하여 추정한 궤적입니다.
빨간점은 FastSLAM의 입자들이고, 검은점은 지표, 파란 십자가는 FastSLAM 으로 추정된 지표 위치입니다.
SLAM을 로봇에 적용한다면, 현재 시간동안 자신의 위치를 계측 또는 측정하면서 동시에 주변환경의 지도를 작성할 수 있습니다.
![FastSLAM 1 0](https://github.com/chihoon05/OSS_new/assets/165778887/1114ebc9-2123-41e3-9d0b-7397d423e847)



# 4) Path Planning (경로 계획)

# 동적 창 접근 방식(DWA)
1.실시간 경로 계획
DWA는 로봇의 센서로부터 실시간으로 받아오는 환경 정보를 사용하여 경로를 계산합니다. 이를 통해 로봇이 동적인 환경에서도 안전하게 이동할 수 있도록 합니다.
2.제약 조건 고려
DWA는 로봇의 속도,가속도,방향 제약 등을 고려하여 경로를 계획합니다. 이를 통해 로봇이 제한된 공간에서도 안전하고 효율적으로 이동할 수 있도록 합니다.
3.경로 최적화:
DWA는 경로 거리, 이동 시간,에너지 소비 등을 고려하여 최적의 경로를 계획합니다. 이를 통해 로봇의 성능을 향상시키고 운영 비용을 줄일 수 있도록 합니다.


![동적 창 접근 방식 (1)](https://github.com/chihoon05/OSS_new/assets/165921459/18c9972d-bdba-4575-81d6-cf0ee32d1341)

# Pythonrobotics A알고리즘
1.최적 경로 찾기
A알고리즘은 시작 지점에서 목표 지점까지 최적의 경로를 찾도록 설계되었습니다. 이는 경로거리, 이동 시간, 에너지 소비 등을 고려하여 가장 효율적인 경로를 계산합니다.

2.효율적인 검색
A알고리즘은 휴리스틱 함수를 사용하여 검색 공간을 효율적으로 탐색합니다. 휴리스틱 함수는 목표 지점까지의 거리를 추정하여,알고리즘이 더 빠르게 최적의 경로를 찾도록 도와줍니다.


# 5) Path Tracking (경로 추적)

# Pure pursuit tracking(경로 추적 알고리즘)
이 알고리즘은 로봇을 현재 위치에서 전방의 전방 주시 지점(Look-Ahead Point)에 도달하도록 이동시키는 각속도 명령을 계산합니다.
1. 경로 계획 : 
빨간선은 목표 경로이고, 녹색 십자가는 순수한 추격 제어를 위한 목표 지점을 의미하며, 파란선은 추적을 뜻하는 지표입니다.
2. 제한 사항 :
웨이포인트 사이의 직선을 정확히 따를 수 없습니다. 이를 통해 성능을 최적화하고 시간이 갈수록 경로에 수렴하려면 파라미터를 조정해야 합니다.
한 지점에서 안정화하지 못합니다. 이를 통해 목표 위치에 거리 임계값을 적용하여 원하는 목표 근처에서 정지시켜야 합니다.

![경로추적 알고리즘](https://github.com/chihoon05/OSS_new/assets/166007094/1c1e6d03-9cbe-4105-986e-9c98ab3fda79)

# Model predictive speed and steering control(예측 속도 및 조향 제어)
1. MPC modeling
MPC 컨트롤러는 선형화된 모델을 기반으로 차량 속도와 조향을 제어합니다.
이 코드는 cvxpy를 최적화 모델링 도구로 사용합니다.
MPC 컨트롤러는 경로 추적을 위해 비용 함수를 최소화하고 있습니다.
특히 전역 좌표계에서 차량 '자전거 모델'의 선형화를 기반으로 한 제어 프로세스 시뮬레이션의 결과를 보고합니다.
제어할 가상 객체는 상세한 다물체 비선형 시스템으로 모델링된 중하중 용량의 트럭이 있습니다.

2. Vehicle model linearization
이는 샘플링 시간 dt를 사용하여 순방향 오일러 이산화를 사용하여 이산시간 모드를 얻을 수 있습니다.
차량 추월이나 장애물 회피 등 높은 주행 속도에서 교통 조작을 자동화하기 위해 개발된 제어 시스템입니다.
이런 종류의 조종은 자동화하기 어렵습니다.
원인은, 차량은 까다로운 동적 시스템으로 측면 동역학은 불안정하고 많은 매개변수의 변화에 민감하며 궤도가 엄격하게 제한되기 때문입니다.

![경로 추적 알고리즘 (1)](https://github.com/chihoon05/OSS_new/assets/165921459/909ddd19-90b5-48ed-8fb0-4f0e8dc07840)


# 6) Arm Navigation (로봇 팔)
대화형 시뮬레이션으로 포인트 제어 시뮬레이션에 대한 두 개의 관절 팔을 의미합니다.
이는 플롯 영역을 왼쪽 클릭하여 effector의 목표 위치를 설정할 수 있습니다.
사용자가 원하는 곳으로 가는 조인트 각도를 결정해야 합니다.
이 문제는 역 운동학으로 알려져 있습니다.

- joint각도 찾는 방법
1. 이펙터를 원하는 좌표로 가져와서 그에 대한 전방 운동학을 해결하는 것입니다.
하지만, 더 쉬운 방법은 팔이 기하학으로 돌아가는 것을 포함합니다.
joint까지의 거리는 피타고라스 정리를 사용하여 이펙터 위치 측면에서 기록됩니다.

2. Forward kinematics
이는 joint각도와 link길이를 감안할 때 이펙터 위치를 지정합니다.
따라서, 순방향 운동학은 역 운동학보다 비교적 쉽습니다.

![Two joint arm](https://github.com/chihoon05/OSS_new/assets/166007094/d7f6ede3-c448-4cc2-98d5-9c0552eb65df)

# 7) Bipedal (이족 보행)

# Bipedal Planner (이족 보행 플래너)
지정된 발자국을 수정(=변경)하여 걷는 이족 보행입니다.

여러 로봇 motion 계획 접근 방식이 존재합니다.
1. 접근 방식
현재 상태와 원하는 보행 속도 벡터를 기반으로 속도 벡터와 미래의 foot 위치를 계산합니다.
1) 위 접근 방식의 유의 사항
이 접근 방식은 로봇 경로에 '장애물이 있는 경우'에는 유효하지 않으므로 안전한 경로 계산 후에만 이족 보행 플래너 알고리즘(Bipedal Planner Algorism)을 적용할 수 있습니다.

2. 효과적인 Bipedal Planner Algorism
임의의 수의 장애물로 복잡한 궤적을 처리할 수 있어야 합니다.

로봇 궤적은 Algorism의 입력 역할을 하며, 이족 보행 플래너(Bipedal Planner)는 경로를 따라 각 단계에 대한 발의 위치와 방향을 출력합니다.
![Bipedal Planner](https://github.com/chihoon05/OSS_new/assets/166033329/d8f89907-85ca-4b83-8bca-2702f445795e)


    
